import{f as k}from"./dateUtil-ohqk8BGA.js";import{K as S,A as y}from"./index-Bf9NpXkZ.js";import{k as s,bn as w,cE as O,_ as m,aX as f,aR as F,d as D,r as C,b as P,I as T,Q as L,K as p,B as R,F as N,a0 as z,ak as B,bd as G,bM as $,cJ as K}from"./vendor-D7Y6X7_h.js";import{_ as M}from"./index.vue_vue_type_style_index_0_lang-reX62h1K.js";import{u as j}from"./dynamic-table-CtWW4hiU.js";import"./ApiSelect.vue_vue_type_script_setup_true_lang-BrXY2i5o.js";let o=function(e){return e.SUCCESS="success",e.ERROR="error",e.UPLOADING="uploading",e}({});const Y=[{title:"文件名",dataIndex:"name",width:150,ellipsis:!0,customRender({record:e}){return s(F,null,{title:()=>e.path,default:()=>s("a",{href:S+e.path,target:"_blank"},[e.name])})}},{title:"预览图",dataIndex:"path",width:150,customRender({record:e}){return s(w,{src:S+e.path},null)}},{title:"文件后缀",dataIndex:"extName",width:80},{title:"类别",dataIndex:"type",width:80},{title:"大小",dataIndex:"size",width:80,customRender:({record:e})=>s(f,{color:"blue"},{default:()=>[e.size]})},{title:"上传者",dataIndex:"username",width:120},{title:"创建时间",dataIndex:"createdAt",width:160,customRender:({record:e})=>k(e.createdAt)}],V=[{dataIndex:"thumbUrl",title:"缩略图",width:100,customRender:({record:e})=>{const{thumbUrl:r}=e;return r&&s(w,{src:r},null)}},{dataIndex:"name",title:"文件名",align:"left",customRender:({text:e,record:r})=>{const{percent:_,status:d}=r||{};let l="normal";return d===o.ERROR?l="exception":d===o.UPLOADING?l="active":d===o.SUCCESS&&(l="success"),s("div",null,[s("p",{class:"truncate mb-1 max-w-[280px]",title:e},[e]),s(O,{percent:_,size:"small",status:l},null)])}},{dataIndex:"size",title:"文件大小",width:100,customRender:({text:e=0})=>e&&`${(e/1024).toFixed(2)}KB`},{dataIndex:"status",title:"状态",width:100,customRender:({text:e})=>e===o.SUCCESS?s(f,{color:"green"},{default:()=>[m("上传成功")]}):e===o.ERROR?s(f,{color:"red"},{default:()=>[m("上传失败")]}):e===o.UPLOADING?s(f,{color:"blue"},{default:()=>[m("上传中")]}):e||"待上传"}],Z=[{field:"name",label:"名称",component:"Input",colProps:{span:8}}],ee=D({__name:"upload-modal",emits:["uploadSuccess"],setup(e,{emit:r}){const _=r,[d]=j(),l=C(!1),u=C([]),I=P(()=>!u.value.some(a=>a.status!==o.SUCCESS)),U=a=>{const{promise:t,resolve:n,reject:c}=Promise.withResolvers(),i=new FileReader;return i.onload=()=>{n(i.result)},i.onerror=b=>{c(b)},i.readAsDataURL(a),t},v=()=>{u.value.some(t=>t.status===o.SUCCESS)&&_("uploadSuccess"),u.value=[]},x=async()=>{const a=u.value.filter(t=>t.status!==o.SUCCESS);await Promise.all(a.map(async t=>{try{await y.toolsUpload.uploadUpload({file:t.file},void 0,{onUploadProgress(n){const c=n.loaded/n.total*100|0;t.percent=c,t.status=o.UPLOADING}}),t.status=o.SUCCESS}catch(n){t.status=o.ERROR}}))},E=async a=>{if(a.size/1024/1024>2)z.error("单个文件不超过2MB");else{const t={file:a,uid:a.uid,name:a.name,size:a.size,status:"",percent:0,thumbUrl:await U(a)};u.value.push(t)}return!1},g=a=>{u.value=u.value.filter(t=>t.uid!==a.uid)},A=[...V,{width:120,title:"操作",dataIndex:"ACTION",fixed:!1,actions:({record:a})=>[{label:"删除",color:"red",onClick:()=>g(a)}]}];return(a,t)=>{const n=B("a-button"),c=G,i=$,b=K;return T(),L(N,null,[s(n,{type:"primary",disabled:!a.$auth("upload:upload"),onClick:t[0]||(t[0]=h=>l.value=!0)},{default:p(()=>[m(" 上传 ")]),_:1},8,["disabled"]),s(R(M),{open:l.value,"onUpdate:open":t[1]||(t[1]=h=>l.value=h),title:"上传",width:800,"ok-text":"开始上传","ok-button-props":{disabled:I.value},onOk:x,onCancel:v},{default:p(()=>[s(b,{justify:"space-between",align:"center"},{default:p(()=>[s(c,{message:"单个文件不超过2MB，最多只能上传10个文件",type:"info","show-icon":""}),s(i,{multiple:!0,"before-upload":E,"show-upload-list":!1},{default:p(()=>[s(n,{type:"primary"},{default:p(()=>[m(" 选择文件 ")]),_:1})]),_:1})]),_:1}),s(R(d),{search:!1,"data-source":u.value,columns:A},null,8,["data-source"])]),_:1},8,["open","ok-button-props"])],64)}}});export{ee as _,Y as b,Z as s};
