import{f as u}from"./dateUtil-ohqk8BGA.js";import{k as h,aX as x,d as w,I as R,J as k,K as c,_ as C,B as f,ak as T}from"./vendor-D7Y6X7_h.js";import{u as _}from"./dynamic-table-CtWW4hiU.js";import{A as l}from"./index-Bf9NpXkZ.js";import"./ApiSelect.vue_vue_type_script_setup_true_lang-BrXY2i5o.js";import"./index.vue_vue_type_style_index_0_lang-reX62h1K.js";import{u as g}from"./useFormModal-DrjhP41g.js";import"./schema-form.vue_vue_type_script_setup_true_lang-BWF4-paj.js";import"./is-CBsgbGQ7.js";import"./index-DKcumURF.js";import"./index-DaE14gLf.js";import"./Icon.vue_vue_type_script_setup_true_lang-B_bz3tPt.js";import"./useModal-p6LRjO4c.js";const P=[{title:"#",dataIndex:"id",width:55,hideInSearch:!0},{title:"角色名称",width:200,dataIndex:"name"},{title:"角色值",width:180,dataIndex:"value"},{title:"状态",dataIndex:"status",width:80,formItemProps:{component:"Select",componentProps:{options:[{label:"启用",value:1},{label:"禁用",value:0}]}},customRender:({record:s})=>{const i=~~s.status===1;return h(x,{color:i?"green":"red"},{default:()=>[i?"启用":"停用"]})}},{title:"备注",dataIndex:"remark"},{title:"创建时间",dataIndex:"createdAt",hideInSearch:!0,customRender:({record:s})=>u(s.createdAt)},{title:"更新时间",dataIndex:"updatedAt",hideInSearch:!0,customRender:({record:s})=>u(s.createdAt)}],v=[{field:"name",component:"Input",label:"角色名称",rules:[{required:!0,type:"string"}],colProps:{span:12}},{field:"value",component:"Input",label:"角色值",rules:[{required:!0,type:"string"}],colProps:{span:12}},{field:"status",label:"状态",component:"RadioGroup",defaultValue:1,componentProps:{options:[{label:"启用",value:1},{label:"停用",value:0}]}},{field:"remark",component:"InputTextArea",label:"备注"},{field:"menuIds",component:"Tree",label:"菜单权限",componentProps:{checkable:!0,vModelKey:"checkedKeys",fieldNames:{title:"name",key:"id"},style:{height:"350px",paddingTop:"5px",overflow:"auto",borderRadius:"6px",border:"1px solid #dcdfe6",resize:"vertical"}}}],J=w({name:"SystemPermissionRole",__name:"index",setup(s){const[i,d]=_(),[I]=g(),r=(e,t,o=[])=>t.reduce((a,n)=>(n.children?.length?r(e,n.children,o):e.includes(n.id)&&a.push(n.id),a),o),m=async e=>{const[t]=await I({modalProps:{title:`${e.id?"编辑":"新增"}角色`,width:"50%",onFinish:async a=>{e.id&&(a.roleId=e.id);const n=t?.compRefMap.get("menuIds"),p={...a,menuIds:[...n.halfCheckedKeys,...n.checkedKeys]};e.id?await l.systemRole.roleUpdate({id:e.id},p):await l.systemRole.roleCreate(p),d?.reload()}},formProps:{labelWidth:100,schemas:v}}),o=await l.systemMenu.menuList({});if(t?.updateSchema([{field:"menuIds",componentProps:{treeData:o}}]),e.id){const a=await l.systemRole.roleInfo({id:e.id});t?.setFieldsValue({...e,menuIds:r(a.menuIds,o)})}},b=async e=>{await l.systemRole.roleDelete({id:e.id}),d?.reload()},y=[...P,{title:"操作",width:130,dataIndex:"ACTION",hideInSearch:!0,fixed:"right",actions:({record:e})=>[{label:"编辑",auth:{perm:"system:role:update",effect:"disable"},onClick:()=>{m(e)}},{label:"删除",auth:"system:role:delete",popConfirm:{title:"你确定要删除吗？",placement:"left",onConfirm:()=>b(e)}}]}];return(e,t)=>{const o=T("a-button");return R(),k(f(i),{"row-key":"id","header-title":"角色管理","title-tooltip":"超级管理员默认拥有所有资源访问权限且不支持修改","data-request":f(l).systemRole.roleList,columns:y,bordered:"",size:"small"},{toolbar:c(()=>[h(o,{type:"primary",disabled:!e.$auth("system:role:create"),onClick:t[0]||(t[0]=a=>m({}))},{default:c(()=>[C(" 新增 ")]),_:1},8,["disabled"])]),_:1},8,["data-request"])}}});export{J as default};
