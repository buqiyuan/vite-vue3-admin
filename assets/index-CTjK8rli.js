import{_ as T}from"./Icon.vue_vue_type_script_setup_true_lang-B_bz3tPt.js";import{_ as q,b as K}from"./AvatarUpload.vue_vue_type_script_setup_true_lang-BEfeP7iC.js";import{A as y}from"./index-Bf9NpXkZ.js";import U from"./DeptTree-BhERHARV.js";import{d as P,r as v,bx as L,I as k,Q as V,R as u,L as C,_ as m,b as A,J as B,K as i,k as s,aq as M,B as h,S as N,a1 as O,co as F,ak as X,bd as W}from"./vendor-D7Y6X7_h.js";import{u as j}from"./dynamic-table-CtWW4hiU.js";import"./ApiSelect.vue_vue_type_script_setup_true_lang-BrXY2i5o.js";import"./index.vue_vue_type_style_index_0_lang-reX62h1K.js";import{u as G}from"./useFormModal-DrjhP41g.js";import{f as J}from"./common-BRsV2ZKK.js";import"./dateUtil-ohqk8BGA.js";import"./schema-form.vue_vue_type_script_setup_true_lang-BWF4-paj.js";import"./is-CBsgbGQ7.js";import"./index-DKcumURF.js";import"./index-DaE14gLf.js";import"./useModal-p6LRjO4c.js";const Q=[{field:"avatar",component:()=>q,label:"头像"},{field:"deptId",component:"TreeSelect",label:"所属部门",componentProps:{fieldNames:{label:"name",value:"id"},getPopupContainer:()=>document.body},rules:[{required:!0,type:"number"}]},{field:"roleIds",component:"Select",label:"所属角色",rules:[{required:!0,type:"array"}],componentProps:{mode:"multiple",request:async()=>{const{items:w=[]}=await y.systemRole.roleList({});return w.map(o=>({label:o.name,value:o.id}))}}},{field:"username",component:"Input",label:"用户名",rules:[{required:!0}]},{field:"password",label:"密码",component:"InputPassword",componentProps:{placeholder:"无需修改请留空"}},{field:"nickname",component:"Input",label:"呢称",colProps:{span:12}},{field:"email",component:"Input",label:"邮箱",colProps:{span:12}},{field:"phone",component:"Input",label:"手机",colProps:{span:12}},{field:"remark",component:"InputTextArea",label:"备注"},{field:"status",component:"RadioGroup",label:"状态",defaultValue:1,componentProps:{options:[{label:"启用",value:1},{label:"禁用",value:0}]}}],z={class:"split-wrapper"},H={class:"left-content"},Y=u("i",null,null,-1),Z=u("i",null,null,-1),ee=[Y,Z],te={class:"right-content"},oe=P({__name:"index",setup(w){const o=v();let r,b;const p=L(function(n){o.value&&(o.value.style.width=`${b+n.clientX-r}px`)},20),d=()=>{document.documentElement.style.userSelect="unset",document.documentElement.removeEventListener("mousemove",p),document.documentElement.removeEventListener("mouseup",d)},a=n=>{r=n.clientX,o.value&&(b=parseInt(window.getComputedStyle(o.value).width,10)),document.documentElement.style.userSelect="none",document.documentElement.addEventListener("mousemove",p),document.documentElement.addEventListener("mouseup",d)};return(n,g)=>(k(),V("div",z,[u("div",{ref_key:"scalable",ref:o,class:"scalable"},[u("div",H,[C(n.$slots,"left-content",{},()=>[m(" 右边内容区 ")])]),u("div",{ref:"separator",class:"separator",onMousedown:a},ee,544)],512),u("div",te,[C(n.$slots,"right-content",{},()=>[m(" 右边内容区 ")])])]))}}),we=P({name:"SystemUser",__name:"index",setup(w){const[o,r]=j({formProps:{autoSubmitOnEnter:!0}}),[b]=G(),p=v(),d=v([]),a=v({selectedRowKeys:[],onChange:(e,t)=>{`${e}`,a.value.selectedRowKeys=e}}),n=A(()=>a.value.selectedRowKeys.length),g=async e=>{const t=await y.systemUser.userList({...e,deptId:p.value});return a.value.selectedRowKeys=[],t},I=async(e={})=>{const{userCreate:t,userUpdate:f}=y.systemUser,_=!!e.id,[l]=await b({modalProps:{title:`${_?"编辑":"新增"}用户`,width:700,onFinish:async c=>{c.id=e.id,e.id?await f({id:e.id},c):await t(c),r?.reload()}},formProps:{labelWidth:100,schemas:Q,autoSubmitOnEnter:!0}});if(e.id){const{roles:c,dept:x}=await y.systemUser.userRead({id:e.id});l?.setFieldsValue({...e,deptId:x.id,roleIds:c.map(D=>D.id)}),l?.updateSchema([{field:"username",componentProps:{disabled:!0}},{field:"password",required:!1}])}else l?.updateSchema([{field:"username",componentProps:{disabled:!1}},{field:"password",required:!0,defaultValue:"a123456",componentProps:{placeholder:"请输入"}}]);l?.updateSchema([{field:"deptId",componentProps:{treeDefaultExpandedKeys:J(d.value,l?.getFieldsValue().deptId)||[],treeData:d.value}}])},S=async e=>{const{userDelete:t}=y.systemUser;Array.isArray(e)?O.confirm({title:"确定要删除所选的用户吗?",icon:s(F,null,null),centered:!0,onOk:async()=>{await t({id:e.join(",")}),r?.reload()}}):await t({id:e}).finally(r?.reload)},E=e=>{p.value=e,r?.reload()},R=e=>{d.value=e},$=[...K,{title:"操作",width:80,dataIndex:"ACTION",fixed:"right",actions:({record:e})=>[{icon:"ant-design:edit-outlined",tooltip:"编辑用户资料",auth:{perm:"system:user:update",effect:"disable"},onClick:()=>I(e)},{icon:"ant-design:delete-outlined",color:"red",tooltip:"删除此账号",auth:"system:user:delete",popConfirm:{title:"你确定要删除吗？",placement:"left",onConfirm:()=>S(e.id)}}]}];return(e,t)=>{const f=X("a-button"),_=T;return k(),B(h(oe),null,{"left-content":i(()=>[s(U,{onSelect:E,onInit:R})]),"right-content":i(()=>[s(h(o),{"header-title":"用户管理","show-index":"","title-tooltip":"请不要随意删除用户，避免到影响其他用户的使用。","data-request":g,columns:$,scroll:{x:2e3},"row-selection":a.value},M({toolbar:i(()=>[s(f,{type:"primary",disabled:!e.$auth("system:user:create"),onClick:t[1]||(t[1]=l=>I({}))},{default:i(()=>[s(_,{icon:"ant-design:plus-outlined"}),m(" 新增 ")]),_:1},8,["disabled"]),s(f,{type:"error",disabled:!n.value||!e.$auth("system:user:delete"),onClick:t[2]||(t[2]=l=>S(a.value.selectedRowKeys))},{default:i(()=>[s(_,{icon:"ant-design:delete-outlined"}),m(" 删除 ")]),_:1},8,["disabled"])]),_:2},[n.value?{name:"title",fn:i(()=>[s(h(W),{class:"w-full",type:"info","show-icon":""},{message:i(()=>[m(" 已选 "+N(n.value)+" 项 ",1),s(f,{type:"link",onClick:t[0]||(t[0]=l=>a.value.selectedRowKeys=[])},{default:i(()=>[m("取消选择")]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["row-selection"])]),_:1})}}});export{we as default};
