import{F as N,G as S,H as O,z as M,_ as D,A as b,J as E}from"./index-Bf9NpXkZ.js";import{i as G,_ as k}from"./Icon.vue_vue_type_script_setup_true_lang-B_bz3tPt.js";import{f as K}from"./dateUtil-ohqk8BGA.js";import{d as V,bt as z,bj as B,r as w,b as L,I as _,J as P,K as u,k as l,Q as R,F as U,U as J,B as c,ad as H,M as W,aq as Q,aJ as X,aK as Y,aS as Z,cg as ee,bl as te,aX as y,bs as ne,_ as h,h as T,R as oe,ak as ae}from"./vendor-D7Y6X7_h.js";import{u as se}from"./index-DaE14gLf.js";import{f as le,s as A}from"./common-BRsV2ZKK.js";import{u as ie}from"./dynamic-table-CtWW4hiU.js";import"./ApiSelect.vue_vue_type_script_setup_true_lang-BrXY2i5o.js";import"./index.vue_vue_type_style_index_0_lang-reX62h1K.js";import{u as re}from"./useFormModal-DrjhP41g.js";import"./schema-form.vue_vue_type_script_setup_true_lang-BWF4-paj.js";import"./is-CBsgbGQ7.js";import"./index-DKcumURF.js";import"./useModal-p6LRjO4c.js";const pe=["title","onClick"],ue=V({inheritAttrs:!1,__name:"IconPicker",props:z(G,{value:{},valueModifiers:{}}),emits:["update:value"],setup(e){N();const s=B(e,"value"),n=Object.entries(S).reduce((t,[r,v])=>(t[r]=Object.keys(v.icons).map(x=>({name:`${v.prefix}:${x}`})),t),{全部:Object.values(S).flatMap(t=>Object.keys(t.icons).map(r=>({name:`${t.prefix}:${r}`})))}),i=w(!1),o=w("全部"),m=w(""),I=L(()=>n[o.value].filter(r=>r.name.includes(m.value))),a=se(t=>{m.value=t.target.value},100),f=t=>{s.value=t,i.value=!1};return(t,r)=>{const v=X,x=Y,C=Z,q=ee,F=te;return _(),P(F,null,{default:u(()=>[l(q,{open:i.value,"onUpdate:open":r[2]||(r[2]=p=>i.value=p),placement:"bottomLeft","overlay-inner-style":{paddingTop:0},trigger:"click"},{title:u(()=>[l(x,{activeKey:o.value,"onUpdate:activeKey":r[0]||(r[0]=p=>o.value=p),size:"small","tab-bar-style":{marginBottom:"8px"}},{default:u(()=>[(_(!0),R(U,null,J(c(n),(p,g)=>(_(),P(v,{key:g,tab:g},null,8,["tab"]))),128))]),_:1},8,["activeKey"]),l(C,{autofocus:"","allow-clear":"",placeholder:`从“${o.value}”中搜索图标`,onChange:c(a)},null,8,["placeholder","onChange"])]),content:u(()=>[l(c(O),{class:"select-box",items:I.value,"key-field":"name","item-size":38,"grid-items":9,"item-secondary-size":38},{default:u(({item:p})=>[(_(),R("div",{key:p.name,title:p.name,class:H([{active:s.value==p.name},"select-box-item"]),onClick:g=>f(p.name)},[l(c(M),{icon:p.name,class:"text-[20px]"},null,8,["icon"])],10,pe))]),_:1},8,["items"])]),default:u(()=>[l(C,W(t.$attrs,{value:s.value,"onUpdate:value":r[1]||(r[1]=p=>s.value=p),placeholder:t.placeholder,"allow-clear":""}),Q({_:2},[s.value?{name:"prefix",fn:u(()=>[l(c(M),{icon:s.value,class:"text-[20px]"},null,8,["icon"])]),key:"0"}:void 0]),1040,["value","placeholder"])]),_:1},8,["open"])]),_:1})}}}),ce=D(ue,[["__scopeId","data-v-04ffd2b1"]]);function $(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!ne(e)}const de=e=>{switch(e){case 0:return l(y,{color:"warning"},{default:()=>[h("目录")]});case 1:return l(y,{color:"success"},{default:()=>[h("菜单")]});case 2:return l(y,{color:"error"},{default:()=>[h("权限")]});default:return""}},me=[{title:"名称",dataIndex:"name",align:"left",fixed:"left",width:200},{title:"图标",width:40,dataIndex:"icon",hideInSearch:!0,customRender:({record:e})=>e.icon&&l(k,{icon:e.icon,size:"22"},null)},{title:"类型",width:80,dataIndex:"type",hideInSearch:!0,customRender:({record:e})=>de(e.type)},{title:"节点路由",dataIndex:"path",width:180,ellipsis:!0},{title:"文件路径",width:180,dataIndex:"component"},{title:"权限标识",width:180,dataIndex:"permission",hideInSearch:!0,customRender:({record:e})=>e.permission&&l(y,{color:"processing"},{default:()=>[e.permission]})},{title:"排序",width:50,dataIndex:"orderNo",hideInSearch:!0},{title:"路由缓存",dataIndex:"keepalive",width:80,hideInSearch:!0,customRender:({record:e})=>e.type===1&&(e.keepAlive?"是":"否")},{title:"是否显示",dataIndex:"show",width:80,hideInSearch:!0,customRender:({record:e})=>{const n=~~e.show===1,i=n?"green":"red",o=n?"显示":"隐藏";return l(y,{color:i},$(o)?o:{default:()=>[o]})}},{title:"状态",dataIndex:"status",width:80,hideInSearch:!0,customRender:({record:e})=>{const n=~~e.status===1,i=n?"green":"red",o=n?"启用":"停用";return l(y,{color:i},$(o)?o:{default:()=>[o]})}},{title:"更新时间",width:180,dataIndex:"updatedAt",hideInSearch:!0,customRender({text:e}){return K(e)}}],fe=e=>e===0,j=e=>e===1,d=e=>e===2,be=()=>[{field:"type",component:"RadioGroup",label:"菜单类型",defaultValue:0,rules:[{required:!0,type:"number"}],componentProps:{options:[{label:"目录",value:0},{label:"菜单",value:1},{label:"权限",value:2}]}},{field:"name",component:"Input",label:({formModel:e})=>d(e.type)?"权限名称":"节点名称",rules:[{required:!0,type:"string"}]},{field:"parentId",component:"TreeSelect",label:"上级节点",componentProps:{fieldNames:{label:"name",value:"id"},request:async({schema:e,formModel:s})=>{const n=await b.systemMenu.menuList({}),i=[-1].concat(le(n,s.parentId)||[]);return e.value.componentProps.treeDefaultExpandedKeys=i,[{id:-1,name:"根目录",children:n}]},getPopupContainer:()=>document.body},rules:[{required:!0,type:"number"}]},{field:"path",component:"Input",label:"路由地址",vIf:({formModel:e})=>!d(e.type),rules:[{required:!0,type:"string"}]},{field:"permission",component:"Input",label:"权限",helpMessage:"对应控制器中定义的权限字符，如：@Perm('system:menu:list'))",vIf:({formModel:e})=>!fe(e.type),required:({formModel:e})=>d(e.type),afterSlot:({schema:e,formInstance:s,formModel:n})=>e.value.component==="Input"?T(k,{icon:"ant-design:folder-open-outlined",title:"选择权限",class:"ml-[12px] cursor-pointer",onclick:async()=>{const i=await b.systemMenu.menuGetPermissions();typeof n.permission=="string"&&(n.permission=n.permission.split(":")),s.updateSchema({field:"permission",component:"Cascader",componentProps:{displayRender:({labels:o})=>o.join(":"),options:i.reduce((o,m)=>(A(m,o,":"),o),[])}})}}):T(k,{icon:"ant-design:edit-outlined",title:"手动输入",class:"ml-[12px] cursor-pointer",onclick:()=>{Array.isArray(n.permission)&&(n.permission=n.permission.join(":")),s.updateSchema({field:"permission",component:"Input"})}})},{field:"component",component:"Cascader",label:"文件路径",vIf:({formModel:e})=>j(e.type)&&!e.isExt,componentProps:{options:Object.keys(E).reduce((e,s)=>(A(s,e,"/"),e),[])},rules:[{required:!0,type:"array"}]},{field:"icon",component:()=>ce,label:"节点图标",vIf:({formModel:e})=>!d(e.type)},{field:"orderNo",component:"InputNumber",label:"排序号",defaultValue:255,componentProps:{style:{width:"100%"}}},{field:"isExt",component:"RadioGroup",label:"是否外链",defaultValue:!1,helpMessage:"选择是外链则路由地址需要以`http(s)://`开头",colProps:{span:12},componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"是",value:!0},{label:"否",value:!1}]},vIf:({formModel:e})=>!d(e.type)},{field:"extOpenMode",component:"RadioGroup",label:"打开方式",defaultValue:1,vIf:({formModel:e})=>!d(e.type)&&e.isExt,colProps:{span:12},componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"新窗口打开",value:1},{label:"内嵌页打开",value:2}]}},{field:"keepAlive",component:"RadioGroup",label:"是否缓存",defaultValue:0,vIf:({formModel:e})=>j(e.type),colProps:{span:12},componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"是",value:1},{label:"否",value:0}]}},{field:"show",component:"RadioGroup",label:"是否显示",defaultValue:1,colProps:{span:12},helpMessage:"会生成路由,但左侧菜单不可见",componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"是",value:1},{label:"否",value:0}]},vIf:({formModel:e})=>!d(e.type)},{field:"activeMenu",component:"Input",label:"高亮菜单项",colProps:{span:12},helpMessage:"值为某个的节点名称(可设置当前路由高亮的菜单项，多用于详情页)",componentProps:{placeholder:"需要高亮的菜单项(节点名称)"},vIf:({formModel:e})=>!e.show&&!d(e.type)},{field:"status",label:"状态",component:"RadioGroup",defaultValue:1,helpMessage:"不会生成路由,同时左侧菜单不可见",componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"启用",value:1},{label:"禁用",value:0}]}}],ye={class:"flex gap-2 ml-2"},Ae=V({name:"SysMenu",__name:"index",setup(e){const[s,n]=ie({pagination:!1,size:"small",rowKey:"id",bordered:!0,scroll:{x:window.innerWidth>2e3?void 0:2e3}}),[i]=re(),o=async a=>{const[f]=await i({modalProps:{title:`${a.id?"编辑":"新增"}菜单`,width:700,onFinish:async t=>{a.id&&(t.menuId=a.id),Array.isArray(t.component)&&(t.component=t.component.join("/")),Array.isArray(t.permission)&&(t.permission=t.permission.join(":")),t.parentId===-1&&Reflect.deleteProperty(t,"parentId"),a.id?await b.systemMenu.menuUpdate({id:a.id},t):await b.systemMenu.menuCreate(t),n.reload()}},formProps:{labelWidth:100,schemas:be()}});f?.setFieldsValue({...a,icon:a.icon??"",parentId:a.parentId??-1,component:a.component?.split("/")})},m=async a=>{await b.systemMenu.menuDelete({id:a.id}),n.reload()},I=[...me,{title:"操作",width:140,dataIndex:"ACTION",hideInSearch:!0,fixed:"right",actions:({record:a})=>[{label:"编辑",auth:{perm:"system:menu:update",effect:"disable"},onClick:()=>o(a)},{label:"新增",auth:{perm:"system:menu:create",effect:"disable"},disabled:a.type===2,onClick:()=>o({parentId:a.id})},{label:"删除",auth:"system:menu:delete",popConfirm:{title:"你确定要删除吗？",placement:"left",onConfirm:()=>m(a)}}]}];return(a,f)=>{const t=ae("a-button");return _(),P(c(s),{"header-title":"菜单管理","data-request":c(b).systemMenu.menuList,columns:I},{afterHeaderTitle:u(()=>[oe("div",ye,[l(t,{onClick:c(n).expandAll},{default:u(()=>[h("展开全部")]),_:1},8,["onClick"]),l(t,{onClick:c(n).collapseAll},{default:u(()=>[h("折叠全部")]),_:1},8,["onClick"])])]),toolbar:u(()=>[l(t,{type:"primary",disabled:!a.$auth("system:menu:create"),onClick:f[0]||(f[0]=r=>o({}))},{default:u(()=>[h(" 新增 ")]),_:1},8,["disabled"])]),_:1},8,["data-request"])}}});export{Ae as default};
