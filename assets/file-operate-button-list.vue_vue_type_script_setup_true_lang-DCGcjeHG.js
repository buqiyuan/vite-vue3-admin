import{_ as K}from"./file-upload-drawer.vue_vue_type_script_setup_true_lang-0qWrqVFo.js";import{A as v}from"./index-Bf9NpXkZ.js";import"./index.vue_vue_type_style_index_0_lang-reX62h1K.js";import{u as V}from"./useFormModal-DrjhP41g.js";import{d as j,r as m,b as k,bS as A,w as C,I as O,Q as E,k as a,K as t,J as R,B as l,_ as i,a8 as T,S as U,F as W,a1 as z,co as G,a0 as D,cp as w,ak as J,cq as Q,aG as x,aF as f,cr as H,cs as X,ct as Y,ax as Z,aR as ee,cu as ae,aP as te,cv as se,cw as le,b0 as ne}from"./vendor-D7Y6X7_h.js";const fe=o=>[{field:"toName",component:"Input",label:`${o.type==="dir"?"文件夹":"文件"}名称`,defaultValue:o.name,rules:[{required:!0,type:"string",validator:(d,s)=>s&&s===o.name?Promise.reject("修改前后名称一致"):s&&!s.includes("/")?Promise.resolve():Promise.reject(`请输入合法${o.type==="dir"?"文件夹":"文件"}的名称`)}],componentProps:{placeholder:"输入重命名后的名称"}}],re=[{field:"dirName",component:"Input",label:"文件夹名称",rules:[{required:!0,type:"string",validator:(o,d)=>d&&!d.includes("/")?Promise.resolve():Promise.reject("请输入合法的文件夹路径")}],componentProps:{placeholder:"请输入文件夹名称"}}],ie=[{field:"key",component:"Input",label:"关键字",defaultValue:"",rules:[{required:!0,type:"string",validator:(o,d)=>d&&!d.includes("/")?Promise.resolve():Promise.reject("请输入合法的名称")}],componentProps:{placeholder:"请输入搜索关键字"}}],he=j({name:"FileOperateButtonList",__name:"file-operate-button-list",props:{selectedFileList:{type:Array,required:!0},parsePath:{type:Function,required:!0},searchKey:{type:String,required:!0},updateOperateStatus:{type:Function,required:!0}},emits:["changed","update:searchKey"],setup(o,{emit:d}){const s=o,c=d,[g]=V(),b=m(),n=m(!1),r=m(!1),h=m(""),y=m([]),F=k(()=>y.value.length>0?!1:s.selectedFileList.length<=0),S=k(()=>n.value&&h.value===s.parsePath()),P=k(()=>!A(s.searchKey));C(n,e=>{e&&(r.value&&(r.value=!1),_())}),C(r,e=>{e&&(n.value&&(n.value=!1),_())});const $=({key:e})=>{e==="copy"?r.value=!0:e==="cut"?n.value=!0:e==="delete"?z.confirm({title:"你确定要删除吗?",icon:a(G),onOk:I}):e==="cancel"&&(n.value=!1,r.value=!1,M())},_=()=>{y.value=w(s.selectedFileList),h.value=s.parsePath()},M=()=>{h.value="",y.value=[]},q=async()=>{try{s.updateOperateStatus(!0);const e={files:y.value,originPath:h.value,toPath:s.parsePath()};let u;if(n.value&&!r.value)await v.netDiskManage.netDiskManageCut(e),u="剪切",n.value=!1;else if(!n.value&&r.value)await v.netDiskManage.netDiskManageCopy(e),u="复制",r.value=!1;else throw new Error("unsupport operate");M(),D.success(`${u}成功`),c("changed")}finally{s.updateOperateStatus(!1)}},I=async()=>{const e=s.parsePath(),u=w(s.selectedFileList);await v.netDiskManage.netDiskManageDelete({path:e,files:u},{showSuccessMsg:!1}),D.success("已删除指定列表"),c("changed")},B=async()=>{if(P.value){c("update:searchKey","");return}await g({modalProps:{title:"全盘搜索",width:700,onFinish:async e=>{c("update:searchKey",e.key)}},formProps:{labelWidth:100,schemas:ie}})},L=()=>{b.value?.open(s.parsePath())},N=async()=>{await g({modalProps:{title:"创建文件夹",width:700,onFinish:async e=>{await v.netDiskManage.netDiskManageMkdir({path:s.parsePath(),dirName:e.dirName}),c("changed")}},formProps:{labelWidth:100,schemas:re}})};return(e,u)=>{const p=J("a-button");return O(),E(W,null,[a(l(ne),null,{default:t(()=>[r.value||n.value?(O(),R(p,{key:0,disabled:S.value,onClick:q},{default:t(()=>[a(l(Q)),i("粘贴 ")]),_:1},8,["disabled"])):T("",!0),a(l(x),{size:"small"},{overlay:t(()=>[a(l(f),{onClick:$},{default:t(()=>[a(l(f).Item,{key:"copy",disabled:!e.$auth("netdisk:manage:copy")},{default:t(()=>[a(l(H)),i(" 复制所选 ")]),_:1},8,["disabled"]),a(l(f).Item,{key:"cut",disabled:!e.$auth("netdisk:manage:cut")},{default:t(()=>[a(l(X),{rotate:-90}),i(" 剪切所选 ")]),_:1},8,["disabled"]),a(l(f).Item,{key:"delete",disabled:!e.$auth("netdisk:manage:delete")},{default:t(()=>[a(l(Y)),i(" 删除所选 ")]),_:1},8,["disabled"]),a(l(f).Item,{key:"cancel",divider:"",disabled:!r.value&&!n.value},{default:t(()=>[a(l(Z)),i(" 取消粘贴 ")]),_:1},8,["disabled"])]),_:1})]),default:t(()=>[a(l(ee),{title:"注意：复制或剪切时会覆盖重名文件",placement:"top"},{default:t(()=>[a(p,{color:"#e6a23c",disabled:F.value},{icon:t(()=>[a(l(ae))]),default:t(()=>[i(" 批量操作 ")]),_:1},8,["disabled"])]),_:1})]),_:1}),a(p,{type:"success",disabled:!e.$auth("netdisk:manage:list"),onClick:B},{icon:t(()=>[a(l(te))]),default:t(()=>[i(" "+U(P.value?"取消搜索":"全盘搜索"),1)]),_:1},8,["disabled"]),a(p,{type:"primary",disabled:!e.$auth("netdisk:manage:token"),onClick:L},{icon:t(()=>[a(l(se))]),default:t(()=>[i(" 上传文件 ")]),_:1},8,["disabled"]),a(p,{onClick:N},{icon:t(()=>[a(l(le))]),default:t(()=>[i(" 创建文件夹 ")]),_:1})]),_:1}),a(K,{ref_key:"uploadDrawerRef",ref:b,onChanged:u[0]||(u[0]=oe=>e.$emit("changed"))},null,512)],64)}}});export{he as _,fe as g};
